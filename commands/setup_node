#!/bin/zsh

# import helpers
source `dirname $0`/helpers

function ensure_mise {
  if command -v mise &> /dev/null; then
    return 0
  fi

  if $IS_MACOS; then
    ensure_brew_package "mise"
  else
    einf "Installing mise via script"
    curl https://mise.run | sh
    export PATH="$HOME/.local/bin:$PATH"
  fi
}

function setup_node {
  ensure_mise
  eval "$(mise activate zsh)"

  einf "Installing latest LTS node via mise"
  mise use -g node@lts

  if ! type "pnpm" > /dev/null 2>&1; then
    einf "Installing pnpm"
    corepack install -g pnpm
  else
    printf "pnpm already installed... skipping\n"
  fi

  einf "Installing global NPM packages"
  cat $NPM_PACKAGES | \
  while read PACKAGE; do
    printf "Installing $PACKAGE... "
    pnpm add -g $PACKAGE
  done
}

askdo setup_node "Setup node installation?"
